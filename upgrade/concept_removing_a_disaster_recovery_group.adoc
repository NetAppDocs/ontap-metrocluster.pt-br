---
permalink: upgrade/concept_removing_a_disaster_recovery_group.html 
sidebar: sidebar 
keywords:  
summary: A partir do ONTAP 9.8, é possível remover um grupo de DR de uma configuração MetroCluster de oito nós para criar uma configuração MetroCluster de quatro nós. 
---
= Remover um grupo DR de uma configuração do MetroCluster
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
A partir do ONTAP 9.8, você pode remover um grupo de recuperação de desastres (DR) de uma configuração MetroCluster de oito nós para criar uma configuração MetroCluster de quatro nós.


NOTE: Use essas etapas durante os fluxos de trabalho de transição e atualização do sistema.



== Ativar o registo da consola

O NetApp recomenda fortemente que você ative o log do console nos dispositivos que você está usando e execute as seguintes ações ao executar este procedimento:

* Deixe o AutoSupport ativado durante a manutenção.
* Acione uma mensagem de manutenção do AutoSupport antes e depois da manutenção para desativar a criação de casos durante a atividade de manutenção.
+
Consulte o artigo da base de dados de Conhecimento link:https://kb.netapp.com/Support_Bulletins/Customer_Bulletins/SU92["Como suprimir a criação automática de casos durante as janelas de manutenção programada"^].

* Ative o registo de sessão para qualquer sessão CLI. Para obter instruções sobre como ativar o registo de sessão, consulte a secção "saída de sessão de registo" no artigo da base de dados de conhecimento link:https://kb.netapp.com/on-prem/ontap/Ontap_OS/OS-KBs/How_to_configure_PuTTY_for_optimal_connectivity_to_ONTAP_systems["Como configurar o PuTTY para uma conetividade ideal aos sistemas ONTAP"^].




== Remova os nós do grupo DR de cada cluster

Este procedimento é suportado a partir do ONTAP 9.8.  Para sistemas executando o ONTAP 9.7 ou anterior, consulte o artigo da Base de Conhecimento:link:https://kb.netapp.com/Advice_and_Troubleshooting/Data_Protection_and_Security/MetroCluster/How_to_remove_a_DR-Group_from_a_MetroCluster["Como remover um grupo de DR de uma configuração do MetroCluster"^] .

.Sobre esta tarefa
Uma configuração de oito nós inclui oito nós organizados como dois grupos de RD de quatro nós.

image::../media/mcc_dr_groups_8_node.gif[nó de grupos de dr de mcc 8]

Quando você remove um grupo de DR, quatro nós permanecem na configuração.

image::../media/mcc_dr_groups_4_node.gif[nó de grupos de dr de mcc 4]

.Antes de começar
* É necessário executar esta etapa em ambos os clusters.
* O `metrocluster remove-dr-group` comando é suportado apenas no ONTAP 9.8 e posterior.


.Passos
. Prepare-se para remover o grupo DR, caso ainda não o tenha feito.
+
.. Mover todos os volumes de dados para outro grupo de recuperação de desastres.
.. Se o grupo DR a ser removido tiver volumes de espelho de compartilhamento de carga, recrie todos os volumes de espelho de compartilhamento de carga em outro grupo DR e exclua-os do grupo DR a ser removido.
.. Mova todos os volumes de metadados MDV_CRS para outro grupo DR seguindo o link:https://docs.netapp.com/us-en/ontap-metrocluster/upgrade/task_move_a_metadata_volume_in_mcc_configurations.html["Movimentação de um volume de metadados nas configurações do MetroCluster"] procedimento.
.. Exclua todos os volumes de metadados MDV_aud que possam existir no grupo DR a serem removidos.
.. Exclua todos os agregados de dados no grupo DR a serem removidos:
+
[listing]
----
ClusterA::> storage aggregate show -node ClusterA-01, ClusterA-02 -fields aggregate ,node
ClusterA::> aggr delete -aggregate aggregate_name
ClusterB::> storage aggregate show -node ClusterB-01, ClusterB-02 -fields aggregate ,node
ClusterB::> aggr delete -aggregate aggregate_name
----
+

NOTE: Agregados raiz não são excluídos.

.. Migre todos os LIFs de dados NAS que você usa para NFS e CIFS (SMB) para nós iniciais em outro grupo de DR. + 
`network interface show -home-node <old_node>`
+
`network interface migrate -vserver <svm_name> -lif <data_lif> -destination-node <new_node> -destination-port <port>`

.. Mova os LIFs de dados para o novo nó inicial em outro grupo de DR.
`network interface modify -vserver <svm-name> -lif <data-lif> -home-node <new_node> -home-port <port>`
.. Migre o LIF de gerenciamento de cluster para um nó inicial em outro grupo de DR.
+
`network interface show -role cluster-mgmt`

+
`network interface modify -vserver <svm-name> -lif <cluster_mgmt> -home-node <new_node> -home-port <port-id>`

+
[NOTE]
====
*** O gerenciamento de nós e os LIFs entre clusters não são migrados.  Crie novos LIFs de gerenciamento de nós e interclusters em nós do grupo DR, conforme necessário.
*** Não é possível migrar ou mover interfaces FCP usadas para acesso em bloco (SAN) entre os nós.  Crie novas interfaces FCP conforme necessário.
*** Os LIFs SAN iSCSI precisam estar inativos antes que o nó inicial e a porta inicial possam ser atualizados.


====
.. Transfira o epsilon para um nó em outro grupo DR, se necessário.
+
[listing]
----
ClusterA::> set advanced
ClusterA::*> cluster show
Move epsilon if needed
ClusterA::*> cluster modify -node nodename -epsilon false
ClusterA::*> cluster modify -node nodename -epsilon true

ClusterB::> set advanced
ClusterB::*> cluster show
ClusterB::*> cluster modify -node nodename -epsilon false
ClusterB::*> cluster modify -node nodename -epsilon true
ClusterB::*> set admin
----


. Identifique e remova o grupo de DR.
+
.. Identifique o grupo DR correto para remoção:
+
`metrocluster node show`

.. Remova os nós do grupo de DR
`metrocluster remove-dr-group -dr-group-id 1`
+
O exemplo a seguir mostra a remoção da configuração do grupo DR no cluster_A.

+
.Exemplo
[%collapsible]
====
[listing]
----
cluster_A::*>

Warning: Nodes in the DR group that are removed from the MetroCluster
         configuration will lose their disaster recovery protection.

         Local nodes "node_A_1-FC, node_A_2-FC"will be removed from the
         MetroCluster configuration. You must repeat the operation on the
         partner cluster "cluster_B"to remove the remote nodes in the DR group.
Do you want to continue? {y|n}: y

Info: The following preparation steps must be completed on the local and partner
      clusters before removing a DR group.

      1. Move all data volumes to another DR group.
      2. Move all MDV_CRS metadata volumes to another DR group.
      3. Delete all MDV_aud metadata volumes that may exist in the DR group to
      be removed.
      4. Delete all data aggregates in the DR group to be removed. Root
      aggregates are not deleted.
      5. Migrate all data LIFs to home nodes in another DR group.
      6. Migrate the cluster management LIF to a home node in another DR group.
      Node management and inter-cluster LIFs are not migrated.
      7. Transfer epsilon to a node in another DR group.

      The command is vetoed if the preparation steps are not completed on the
      local and partner clusters.
Do you want to continue? {y|n}: y
[Job 513] Job succeeded: Remove DR Group is successful.

cluster_A::*>
----
====


. Repita a etapa anterior no cluster de parceiros.
. Desabilite o failover de armazenamento nos nós do antigo grupo de DR:
+
`storage failover modify -node <node-name> -enable false`

. Se você estiver em uma configuração de IP do MetroCluster , execute as seguintes etapas para excluir os plexos remotos dos agregados raiz e remover a propriedade do disco nos nós do antigo grupo de DR.
+
Essas etapas precisam ser executadas para ambos os nós no par HA em cada site.

+
.. Exibir os plexos remotos de agregados raiz nos nós no grupo DR que deve ser excluído:
+
`storage aggregate plex show -aggregate <root_aggr_name> -pool 1`

.. Exclua os plexos remotos:
+
`storage aggregate plex delete -aggregate <root_aggr_name> -plex <plex_from_previous_step>`

.. Identifique os discos remotos pertencentes aos nós no grupo DR.
+
Os comandos que você usa dependem se você está usando discos particionados/compartilhados ou discos inteiros:

+

NOTE: Use uma lista separada por vírgulas no `-owner <node_names>` campo para especificar os nomes dos nós no grupo DR que devem ser excluídos.

+
[role="tabbed-block"]
====
.Discos particionados/compartilhados:
--
... Defina o nível de privilégio como avançado:
+
`set advanced`

... Exibir os discos remotos:
+
`storage disk show -pool Pool1 -owner <node_names> -partition-ownership`



--
.Discos inteiros:
--
... Defina o nível de privilégio como avançado:
+
`set advanced`

... Exibir os discos remotos:
+
`storage disk show -pool Pool1 -owner <node_names>`



--
====
.. Desabilitar atribuição automática de disco:
+
`disk option modify -node <node_names_in_the_DR_group_to_be_deleted>  -autoassign off`

.. Remova a propriedade dos discos do pool1 em cada nó do grupo DR a ser excluído.  Execute estas etapas em cada nó a ser removido.
+
... Vá para o nodeshell:
+
`run -node <node_name>`

... Identifique os discos do pool1:
+
`aggr status -s`

+
Todos os discos sobressalentes são exibidos, incluindo os discos sobressalentes pool0 e pool1 de propriedade do nó.

... Remova a propriedade do disco para cada disco sobressalente do pool1:
+
`disk remove_ownership <disk_name>`

+
Para discos particionados, remova a propriedade da partição e, em seguida, remova a propriedade do disco do contêiner.





. Se você estiver em uma configuração de IP do MetroCluster , remova as conexões do MetroCluster nos nós do antigo grupo de DR.
+
Esses comandos podem ser emitidos de qualquer cluster e se aplicam a todo o grupo de DR abrangendo ambos os clusters.

+
.. Desligar as ligações:
+
`metrocluster configuration-settings connection disconnect -dr-group-id <dr_group_id>`

+
.Exemplo
[%collapsible]
====
[listing]
----
cluster_A::*> metrocluster configuration-settings connection disconnect -dr-group-id 1

Warning: For the nodes in the DR group 1, this command will remove the existing connections that are used to mirror NV logs and access remote storage.
Do you want to continue? {y|n}: y

Warning: Before proceeding with disconnect, you must verify the following:
      1. Unmirrored aggregates do not have disks in remote plexes.
      2. Aggregates are not mirrored.
      3. No disks are assigned in Pool1.
      4. Storage failover is not enabled.
      Follow the "MetroCluster Installation and Configuration guide" for detailed instructions to verify this.
Do you want to continue? {y|n}: y
----
====
.. Exclua as interfaces MetroCluster nos nós do antigo grupo DR:
+

NOTE: Esta etapa deve ser repetida em cada nó do grupo DR.

+
`metrocluster configuration-settings interface delete`

.. Exclua a configuração do antigo grupo DR. E
`metrocluster configuration-settings dr-group delete`


. Desmarque os nós no grupo DR antigo.
+
Execute esta etapa em cada cluster.

+
.. Defina o nível de privilégio avançado:
+
`set -privilege advanced`

.. Desvincular o nó: +
`cluster unjoin -node <node-name>`
+
Repita esta etapa para o outro nó local no grupo DR antigo.

.. Defina o nível de privilégio do administrador:
+
`set -privilege admin`



. Verifique se o cluster HA está habilitado no novo grupo DR.  Se necessário, reative o cluster HA:
+
`cluster ha modify -configured true`

+
Execute esta etapa em cada cluster.

. Pare, desligue e remova os antigos módulos de controladora e compartimentos de storage.

